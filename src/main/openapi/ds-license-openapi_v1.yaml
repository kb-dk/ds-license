openapi: 3.0.2
info:
  version: 'v1'
  title: '${project.name}'
  description: |
    ${project.description}
  contact:
    email: '${user.name}@kb.dk'
  license:
    name: '${license.name}'
    url: '${license.url}'
servers: #  /api must match servlet-mapping in web.xml
  - url: '${config:openapi.serverurl}'
    description: 'Version 1'

paths:
  /checkAccessForIds:
    post:
      tags:
        - '${project.name}'
      summary: 'Takes an array of recordIds. Will filter the ids and return only those that the users has access to by the licences granted to the user. Id filter field is defined in the YAML configuration'
      operationId: checkAccessForIds
      security:
        - KBOAuth:
            - public
      requestBody:
        content:
          application/json: # Media type
            schema: # Request body contents
              $ref: '#/components/schemas/CheckAccessForIdsInput'
      responses:
        '200':
          description: 'Returns the ids that has not been filtered by the query. Also return the Solr filter query that was used'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckAccessForIdsOutput'

  /checkAccessForResourceIds:
    post:
      tags:
        - '${project.name}'
      summary: 'Takes an array of resource ids. Will filter the ids and return only those that the users has access to by the licences granted to the user. ResourceID filter field is defined in the YAML configuration'
      operationId: checkAccessForResourceIds
      security:
        - KBOAuth:
            - public
      requestBody:
        content:
          application/json: # Media type
            schema: # Request body contents
              $ref: '#/components/schemas/CheckAccessForIdsInput'
      responses:
        '200':
          description: 'Returns the ids that has not been filtered by the query. Also return the Solr filter query that was used. Ids that exists but with no access will be return in nonAccessId field'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckAccessForIdsOutput'

  /validateAccess:
    post:
      tags:
        - '${project.name}'
      summary: 'Validate if user has access to all groups in input'
      operationId: validateAccess
      security:
        - KBOAuth:
            - public
      requestBody:
        content:
          application/json: # Media type
            schema: # Request body contents
              $ref: '#/components/schemas/ValidateAccessInput'
      responses:
        '200':
          description: 'True or false'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateAccessOutput'

  /getUserLicenses:
    post:
      tags:
        - '${project.name}'
      summary: 'Get a list of all licences that validates from user attributes'
      operationId: getUserLicenses
      security:
        - KBOAuth:
            - public
      requestBody:
        content:
          application/json: # Media type
            schema: # Request body contents
              $ref: '#/components/schemas/GetUsersLicensesInput'
      responses:
        '200':
          description: 'Returns the names of all the licences that validates for the user'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetUsersLicensesOutput'

  /getUserLicenseQuery:
    post:
      tags:
        - '${project.name}'
      summary: 'Shows the filter query for Solr generated from the user attributes. PresentationType are defined in configuration. Example: Search'
      operationId: getUserLicenseQuery
      security:
        - KBOAuth:
            - public
      requestBody:
        content:
          application/json: # Media type
            schema: # Request body contents
              $ref: '#/components/schemas/GetUserQueryInput'
      responses:
        '200':
          description: 'The Solr filter query'
          content:
            application/json: # Media type
              schema: # Request body contents
                $ref: '#/components/schemas/GetUsersFilterQueryOutput'
                example: '{"filterQuery": "(((subject:\"Tyskland\") OR (id:*manus!judsam!*)) -(access_blokeret:true))"}'

  /getUserGroups:
    post:
      tags:
        - '${project.name}'
      summary: 'Get the groups that the user has access to'
      operationId: getUserGroups
      security:
        - KBOAuth:
            - public
      requestBody:
        content:
          application/json: # Media type
            schema: # Request body contents
              $ref: '#/components/schemas/GetUserGroupsInput'
      responses:
        '200':
          description: 'Names of the groups and presentationtype that the user has access to'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetUserGroupsOutput'

  /getUserGroupsAndLicenses:
    post:
      tags:
        - '${project.name}'
      summary: 'Get all licenses and groups/presentationtypes that the user has access to. Will also list all licenses defined and presentationtypes'
      operationId: getUserGroupsAndLicenses
      security:
        - KBOAuth:
            - public
      requestBody:
        content:
          application/json: # Media type
            schema: # Request body contents
              $ref: '#/components/schemas/GetUserGroupsAndLicensesInput'
      responses:
        '200':
          description: 'List all licenses and groups/presentationtypes that the user has access to. Will also list all licenses defined and presentationtypes'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetUserGroupsAndLicensesOutput'

  # Audit
  /audit/auditEntryById:
    get:
      tags:
        - 'DsAudit'
      summary: 'Return the AuditLogEntry with the given id'
      operationId: getAuditEntryById
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: id
          in: query
          description: 'Filter on id'
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 'Get specific audit log by id'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogEntryOutput'

  /audit/auditEntriesByObjectId:
    get:
      tags:
        - 'DsAudit'
      summary: 'Return a list of AuditLogEntry related to an object by object id'
      operationId: getAuditEntriesByObjectId
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: objectid
          in: query
          description: 'Filter on objectid'
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 'Return all audit logs related to objectid'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditLogEntryOutput'

  # Rights
  /rights/platforms:
    get:
      tags:
        - 'DsRights'
      summary: 'Get all available platforms'
      operationId: getPlatforms
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      responses:
        '200':
          description: 'A JSON array of available platforms'
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object

  /rights/idTypes:
    get:
      tags:
        - 'DsRights'
      summary: 'Get all allowed id types in the rights component'
      operationId: getIdTypes
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: platform
          in: query
          description: 'The platform to extract id types for'
          schema:
            $ref: '#/components/schemas/PlatformEnum'
      responses:
        '200':
          description: 'A JSON array of allowed id types'
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string

  /rights/restrictedId:
    get:
      tags:
        - 'DsRights'
      summary: 'Get a restricted id by idValue, idType, and platform'
      operationId: getRestrictedId
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: idValue
          in: query
          required: true
          schema:
            type: string
        - name: idType
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/IdTypeEnum'
        - name: platform
          in: query
          required: true
          schema:
            $ref: '#/components/schemas/PlatformEnum'
      responses:
        '200':
          description: 'Get a restricted id'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestrictedIdOutput'
        '404':
          description: 'Restricted id not found'
    post:
      tags:
        - 'DsRights'
      summary: 'Create a restricted id'
      operationId: createRestrictedId
      security:
        - KBOAuth:
            - ds-license-admin
      parameters:
        - name: touchRecord
          in: query
          schema:
            type: boolean
            default: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestrictedIdInput'
            examples:
              DrProductionID:
                value:
                  idValue: '12345678'
                  idType: 'DR_PRODUCTION_ID'
                  platform: 'DRARKIV'
                  title: 'TV Avisen'
                  comment: 'Dette er en test'
      responses:
        '200':
          description: 'Created restricted id'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestrictedIdOutput'

  /rights/restrictedId/{id}:
    put:
      tags:
        - 'DsRights'
      summary: 'Only title and/or comment can be updated'
      description: 'Updates title and/or comment of restricted id. The requester should always send the information in all fields'
      operationId: updateRestrictedId
      security:
        - KBOAuth:
            - ds-license-admin
      parameters:
        - name: id
          in: path
          description: 'The unique id of a restricted id'
          required: true
          schema:
            type: integer
            format: int64
        - name: touchRecord
          in: query
          schema:
            type: boolean
            default: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestrictedIdInput'
            examples:
              DsId:
                value:
                  idValue: 'ds.tv:oai:io:6f9017fb-810a-4386-98cc-debd1f19b48d'
                  idType: 'DS_ID'
                  platform: 'DRARKIV'
                  title: 'TV Avisen'
                  comment: 'Opdateret kommentar'
              DrProductionID:
                value:
                  idValue: '12345678'
                  idType: 'DR_PRODUCTION_ID'
                  platform: 'DRARKIV'
                  title: 'TV Avisen'
                  comment: 'Opdateret kommentar'
              StrictTitle:
                value:
                  idValue: 'Helt sort'
                  idType: 'STRICT_TITLE'
                  platform: 'DRARKIV'
                  title: 'Helt sort'
                  comment: 'Opdateret kommentar'
      responses:
        '200':
          description: 'Updated restricted id'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestrictedIdOutput'

  /rights/restrictedId/delete/{id}:
    post:
      tags:
        - 'DsRights'
      summary: 'Delete restricted id by id'
      operationId: deleteRestrictedId
      security:
        - KBOAth:
            - ds-license-admin
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: touchRecord
          in: query
          schema:
            type: boolean
            default: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteReason'
      responses:
        '200':
          description: 'Deleted'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecordsCount'

  /rights/restrictedIds:
    get:
      tags:
        - 'DsRights'
      summary: 'Get restricted ids from idType and platform'
      operationId: getAllRestrictedIds
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: idType
          in: query
          required: true
          description: 'Required filter on idType'
          schema:
            $ref: '#/components/schemas/IdTypeEnum'
        - name: platform
          in: query
          required: true
          description: 'Required filter on platform'
          schema:
            $ref: '#/components/schemas/PlatformEnum'
      responses:
        '200':
          description: 'List of restricted ids'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RestrictedIdOutput'
    post:
      tags:
        - 'DsRights'
      summary: 'Create multiple restricted ids or updates if they already exists'
      operationId: createOrUpdateRestrictedIds
      security:
        - KBOAuth:
            - ds-license-admin
      parameters:
        - name: touchRecord
          in: query
          schema:
            type: boolean
            default: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/RestrictedIdInput'
            example:
              - idValue: 'ds.tv:oai:io:111017fb-810a-4386-98cc-debd1f19b48d'
                idType: 'DS_ID'
                platform: 'DRARKIV'
                title: 'TV Avisen'
                comment: 'test multi 1'
              - idValue: 'ds.radio:oai:io:11156005-39e6-4fc3-90a5-830efded34a0'
                idType: 'DS_ID'
                platform: 'DRARKIV'
                title: 'TV Avisen'
                comment: 'test multi 2'
              - idValue: '12345678'
                idType: 'DR_PRODUCTION_ID'
                platform: 'DRARKIV'
                title: 'TV Avisen'
                comment: 'test multi 3'
      responses:
        '200':
          description: 'Status on restricted ids creation or updates'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProcessedRestrictedIdsOutput'

  /rights/restrictedId/check/dr-arkiv/{dsId}:
    get:
      tags:
        - 'DsRights'
      description: 'Returns a DrBroadcastDto object that shows if the input dsId broadcast has a drProductionId. DrBroadcastDto has a list of BroadcastDto that is populated with broadcasts sharing the same drProductionId. Each BroadcastDto also shows if there is a restriction and restriction comment on that broadcast'
      operationId: matchingDrProductionIdBroadcasts
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: dsId
          in: path
          description: 'The unique id of a DR-arkiv broadcast'
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 'Get broadcasts'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DrBroadcast'
        '400':
          description: 'An error occurred in the request. This can be a validation error for the path variable dsId'
          content:
            application/json:
              schema:
                type: object
        '404':
          description: 'dsId: {dsId} not found'
          content:
            application/json:
              schema:
                type: object
        '503':
          description: 'An error occurred when sending the request to Solr. The service is currently unavailable'
          content:
            application/json:
              schema:
                type: object

  /rights/drHoldbackRules:
    get:
      tags:
        - 'DsRights'
      summary: 'Get all DR holdback rules'
      operationId: getDrHoldbackRules
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      responses:
        '200':
          description: 'List of DR holdback rules'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DrHoldbackRuleOutput'

  /rights/drHoldbackRule:
    get:
      tags:
        - 'DsRights'
      summary: 'Get a DR holdback rule by drHoldbackValue'
      operationId: getDrHoldbackRuleByDrHoldbackValue
      security:
        - KBOAuth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: drHoldbackValue
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 'Retrieve a DR holdback rule'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DrHoldbackRuleOutput'
        '404':
          description: 'Not found'
    post:
      tags:
        - 'DsRights'
      summary: 'Creates a DR holdback rule'
      operationId: createDrHoldbackRule
      security:
        - KBOAuth:
            - ds-license-admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DrHoldbackRuleInput'
            examples:
              example1:
                value:
                  drHoldbackValue: '2.03'
                  name: 'Testing'
                  days: 100
                  changeName: null
      responses:
        '200':
          description: 'Created DR holdback rule'
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/DrHoldbackRuleOutput'

  /rights/drHoldbackRule/{id}:
    put:
      tags:
        - 'DsRights'
      summary: 'Only days can be updated'
      description: 'Updates days of a DR holdback rule. The requester should always send the information in all fields'
      operationId: updateDrHoldbackRule
      security:
        - KBOAuth:
            - ds-license-admin
      parameters:
        - name: id
          in: path
          description: 'The unique id of a DR holdback rule'
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DrHoldbackRuleInput'
            examples:
              drHoldbackRule:
                value:
                  drHoldbackValue: '2.03'
                  name: 'Testing'
                  days: 100
                  changeComment: 'Omstændighederne har ændret sig'
      responses:
        '200':
          description: 'Updated DR holdback rule'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DrHoldbackRuleOutput'

  /rights/drHoldbackRule/delete/{id}:
    post:
      tags:
        - 'DsRights'
      summary: 'Delete DR holdback rule by drHoldbackValue'
      operationId: deleteDrHoldbackRule
      security:
        - KBOAth:
            - ds-license-admin
      parameters:
        - name: id
          in: path
          description: 'The unique id of a DR holdback rule'
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteReason'
      responses:
        '200':
          description: 'Deleted'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecordsCount'

  /rights/drHoldbackRanges:
    get:
      tags:
        - 'DsRights'
      summary: 'Get all DR holdback ranges for a drHoldbackValue'
      operationId: getDrHoldbackRanges
      security:
        - KBOAth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: drHoldbackValue
          in: query
          description: 'Filter on drHoldbackValue'
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DrHoldbackRangeOutput'
    post:
      tags:
        - 'DsRights'
      summary: 'Creates DR holdback ranges for a drHoldbackValue'
      operationId: createDrHoldbackRanges
      security:
        - KBOAth:
            - ds-license-admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DrHoldbackRangeInput'
      responses:
        '200':
          description: 'Created DR holdback ranges'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DrHoldbackRangeOutput'

  /rights/drHoldbackRanges/delete/{drHoldbackValue}:
    post:
      tags:
        - 'DsRights'
      summary: 'Delete DR holdback ranges by drHoldbackValue'
      operationId: deleteDrHoldbackRanges
      security:
        - KBOAth:
            - ds-license-admin
      parameters:
        - name: drHoldbackValue
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteReason'
      responses:
        '200':
          description: 'Deleted'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecordsCount'

  /rights/getDrHoldbackValueFromContentAndForm:
    get:
      tags:
        - 'DsRights'
      summary: 'Get the drHoldbackValue from content and form metadata'
      operationId: getDrHoldbackValueFromContentAndForm
      security:
        - KBOAth:
            - ds-license-readonly
            - ds-license-admin
      parameters:
        - name: content
          in: query
          required: true
          schema:
            type: integer
        - name: form
          in: query
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: ok
          content:
            application/json:
              schema:
                type: string

  /rights/calculate:
    post:
      tags:
        - 'DsRights'
      summary: 'Calculate restrictions for a record based on input values'
      operationId: calculateRights
      security:
        - KBOAuth:
            - public
      # No Oauth. Only called by system calls when indexing and no oauth is used system2system in ingest(write) environment.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RightsCalculationInput'
      responses:
        '200':
          description: 'Solr compliant fields and values'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RightsCalculationOutput'

  /monitor:
    post:
      tags:
        - Service
      summary: 'Still TODO, Some statistics for monitoring the application'
      operationId: extractStatistics
      responses:
        '200':
          description: 'TODO'
          content:
            application/json:
              schema:
                type: string

  /monitor/whoami:
    get:
      tags:
        - Service
      summary: 'Extract OAuth2 accessToken in the `Authorization` HTTP header and return the roles from it'
      operationId: probeWhoami
      security:
        - KBOAuth:
            - public
      responses:
        '200':
          description: 'OK'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Whoami'

  # The ping service should be in all projects, should not do any advanced processing
  # and should respond quickly with a simple message, e.g. "pong".
  #
  # Note that it is placed under /monitor. The top namespace /monitor is intended for
  # proxying to monitoring software or manual health checks. All endpoints under that
  # namespace should be safe to expose: No changes to state, no confidential information!
  #
  # Note that the more detailed /monitor/status is defined below.
  /monitor/ping:
    get:
      tags:
        - Service
      summary: 'Ping the server to check if the server is reachable'
      operationId: ping
      x-useGenericResponse: false # If enabled the method will return Response
      x-streamingOutput: false # If enabled the method will return StreamingOutput.
      responses:
        '200':
          description: 'OK'
          content:
            text/plain:
              schema:
                type: string

  # The status service should be in all projects and should provide a list of running jobs,
  # the overall health of the service and similar. While the endpoint should be kept at
  # /monitor/status, the response should be adjusted to fit the application.
  #
  # Note that it is placed under /monitor. The top namespace /monitor is intended for
  # proxying to monitoring software or manual health checks. All endpoints under that
  # namespace should be safe to expose: No changes to state, no confidential information!
  #
  # Note that the simple /monitor/ping is defined above.
  /monitor/status:
    get:
      tags:
        - Service
      summary: 'Detailed status / health check for the service'
      operationId: status
      responses:
        '200':
          description: 'OK'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Status'
        '500':
          description: 'Internal Error'
          content:
            text/plain:
              schema:
                type: string

components:
  schemas:
    DrBroadcast:
      type: object
      description: 'Object containing results with the same drProductionId'
      properties:
        drProductionId:
          type: string
          description: 'DR-arkiv production id'
        restricted:
          type: boolean
          description: 'Is the drProductionId restricted?'
        restrictedComment:
          type: string
          description: 'Comment about why drProductionId is restricted, if it is restricted'
        broadcast:
          type: array
          items:
            $ref: '#/components/schemas/Broadcast'

    Broadcast:
      type: object
      required:
        - dsId
        - title
        - startTime
        - endTime
        - restricted
      properties:
        dsId:
          type: string
          description: 'Unique id of a broadcast'
        title:
          type: string
          description: 'Title for broadcast'
        startTime:
          type: string
          format: date-time
          description: 'Start time of broadcast'
        endTime:
          type: string
          format: date-time
          description: 'End time of broadcast'
        restricted:
          type: boolean
          description: 'Is the broadcast restricted?'
        restrictedComment:
          type: string
          description: 'Comment about why broadcast is restricted, if it is restricted'

    CheckAccessForIdsInput:
      type: object
      properties:
        presentationType:
          type: string
          example: 'Stream'
        accessIds:
          type: array
          example: [ 'id1','id2' ]
          items:
            type: string
        attributes:
          type: array
          items:
            $ref: '#/components/schemas/UserObjAttribute'

    CheckAccessForIdsOutput:
      type: object
      properties:
        presentationType:
          type: string
        query:
          type: string
          description: 'Solr query'
        accessIds:
          type: array
          items:
            type: string
        nonAccessIds:
          type: array
          items:
            type: string
        nonExistingIds:
          type: array
          items:
            type: string

    ValidateAccessInput:
      type: object
      properties:
        presentationType:
          type: string
          example: 'Stream'
        groups:
          type: array
          example: [ 'group1','group2' ]
          items:
            type: string
        attributes:
          type: array
          items:
            $ref: '#/components/schemas/UserObjAttribute'

    ValidateAccessOutput:
      type: object
      properties:
        access:
          type: boolean

    LicenseOverview:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        validFrom:
          type: string
        validTo:
          type: string

    UserObjAttribute:
      type: object
      properties:
        attribute:
          type: string
          description: 'Key/Values attributes describing the user'
          example: 'wayf.mail'
        values:
          type: array
          example: [ 'teg@kb.dk' ]
          items:
            type: string

    GetUserGroupsAndLicensesInput:
      type: object
      properties:
        locale:
          type: string
          example: 'da'
        attributes:
          type: array
          items:
            $ref: '#/components/schemas/UserObjAttribute'

    GetUserGroupsAndLicensesOutput:
      type: object
      properties:
        groups:
          type: array
          items:
            $ref: '#/components/schemas/UserGroup'
        licenses:
          type: array
          items:
            $ref: '#/components/schemas/LicenseOverview'
        allPresentationTypes:
          type: array
          items:
            type: string
        allGroups:
          type: array
          items:
            type: string

    GetUsersLicensesInput:
      type: object
      properties:
        locale:
          type: string
        attributes:
          type: array
          items:
            $ref: '#/components/schemas/UserObjAttribute'

    GetUsersLicensesOutput:
      type: object
      properties:
        licenses:
          type: array
          items:
            $ref: '#/components/schemas/LicenseOverview'

    GetUsersFilterQueryOutput:
      type: object
      properties:
        filterQuery:
          type: string

    GetUserQueryInput:
      type: object
      properties:
        presentationType:
          type: string
        attributes:
          type: array
          items:
            $ref: '#/components/schemas/UserObjAttribute'

    GetUserQueryOutput:
      type: object
      properties:
        query:
          type: string
        userLicenseGroups:
          type: array
          items:
            type: string
        userNotInDenyGroups:
          type: array
          items:
            type: string

    GetUserGroupsInput:
      type: object
      properties:
        locale:
          type: string
          example: 'da'
        attributes:
          type: array
          items:
            $ref: '#/components/schemas/UserObjAttribute'

    GetUserGroupsOutput:
      type: object
      properties:
        groups:
          type: array
          items:
            $ref: '#/components/schemas/UserGroup'

    UserGroup:
      type: object
      properties:
        groupName:
          type: string
        presentationTypes:
          type: array
          items:
            type: string

    # Rights module
    PlatformEnum:
      type: string
      enum:
        - DRARKIV
        - GENERIC

    IdTypeEnum:
      type: string
      enum:
        - DS_ID
        - DR_PRODUCTION_ID
        - STRICT_TITLE
        - OWNPRODUCTION_CODE

    ChangeTypeEnum:
      type: string
      enum:
        - CREATE
        - UPDATE
        - DELETE

    ObjectTypeEnum:
      type: string
      enum:
        - DS_ID
        - DR_PRODUCTION_ID
        - STRICT_TITLE
        - OWNPRODUCTION_CODE
        - CLAUSE_PRODUCTION_CODE
        - CLAUSE_STRICT_TITLE
        - PRESENTATION_TYPE
        - LICENSE
        - GROUP_TYPE
        - HOLDBACK_DAY
        - HOLDBACK_RULE
        - HOLDBACK_RANGE
        - ATTRIBUTE_NAME

    AuditLogEntryOutput:
      type: object
      required:
        - id
        - objectId
        - modifiedTime
        - userName
        - changeType
        - changeName
      properties:
        id:
          type: integer
          format: int64
        objectId:
          type: integer
          format: int64
        modifiedTime:
          type: integer
          format: int64
        userName:
          type: string
        changeType:
          $ref: '#/components/schemas/ChangeTypeEnum'
        changeName:
          $ref: '#/components/schemas/ObjectTypeEnum'
        identifier:
          type: string
        changeComment:
          type: string
        textBefore:
          type: string
        textAfter:
          type: string

    RestrictedIdInput:
      type: object
      required:
        - idValue
        - idType
        - platform
        - title
        - comment
      properties:
        idValue:
          type: string
        idType:
          $ref: '#/components/schemas/IdTypeEnum'
        platform:
          $ref: '#/components/schemas/PlatformEnum'
        title:
          type: string
        comment:
          type: string

    RestrictedIdOutput:
      type: object
      required:
        - id
        - idValue
        - idType
        - platform
      properties:
        id:
          type: integer
          format: int64
        idValue:
          type: string
        idType:
          $ref: '#/components/schemas/IdTypeEnum'
        platform:
          $ref: '#/components/schemas/PlatformEnum'
        title:
          type: string
        comment:
          type: string

    ProcessedRestrictedIdsOutput:
      type: object
      required:
        - processStatus
      properties:
        processStatus:
          $ref: '#/components/schemas/ProcessStatus'
        processedSuccessfully:
          type: integer
        failedRestrictedIds:
          type: array
          items:
            $ref: '#/components/schemas/FailedRestrictedId'

    ProcessStatus:
      type: string
      enum:
        - success
        - partial processed
        - failed
      x-enum-varnames:
        - SUCCESS
        - PARTIAL_PROCESSED
        - FAILED
      x-enum-descriptions:
        - success
        - partial processed
        - failed

    FailedRestrictedId:
      type: object
      required:
        - idValue
        - idType
        - platform
        - exception
        - errorMessage
      properties:
        idValue:
          type: string
        idType:
          $ref: '#/components/schemas/IdTypeEnum'
        platform:
          $ref: '#/components/schemas/PlatformEnum'
        title:
          type: string
        comment:
          type: string
        exception:
          type: string
        errorMessage:
          type: string

    DrHoldbackRuleInput:
      type: object
      required:
        - drHoldbackValue
        - name
        - days
      properties:
        drHoldbackValue:
          type: string
        name:
          type: string
        days:
          type: integer
        changeComment:
          type: string

    DrHoldbackRuleOutput:
      type: object
      required:
        - id
        - drHoldbackValue
        - name
        - days
      properties:
        id:
          type: integer
          format: int64
        drHoldbackValue:
          type: string
        name:
          type: string
        days:
          type: integer

    DrHoldbackRange:
      type: object
      required:
        - contentRangeFrom
        - contentRangeTo
        - formRangeFrom
        - formRangeTo
      properties:
        contentRangeFrom:
          type: integer
        contentRangeTo:
          type: integer
        formRangeFrom:
          type: integer
        formRangeTo:
          type: integer
    
    DrHoldbackRangeInput:
      type: object
      required:
        - drHoldbackValue
        - ranges
      properties:
        drHoldbackValue:
          type: string
        ranges:
          type: array
          items:
            $ref: '#/components/schemas/DrHoldbackRange'

    DrHoldbackRangeOutput:
      type: object
      required:
        - id
        - contentRangeFrom
        - contentRangeTo
        - formRangeFrom
        - formRangeTo
        - drHoldbackValue
      properties:
        id:
          type: integer
          format: int64
        contentRangeFrom:
          type: integer
        contentRangeTo:
          type: integer
        formRangeFrom:
          type: integer
        formRangeTo:
          type: integer
        drHoldbackValue:
          type: string

    DeleteReason:
      type: object
      required:
        - changeComment
      properties:
        changeComment:
          type: string
          description: 'Why are we deleting this object?'

    HelloReply:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: 'Greeting from the API'

    RightsCalculationInput:
      description: 'An overall Data Transfer Object which should be used to carry all values needed for calculating rights for a record between services'
      type: object
      x-isRightsCalculationObject: true
      properties:
        recordId:
          type: string
          description: 'Id of the record, which this metadata comes from'
        platform:
          $ref: '#/components/schemas/PlatformEnum'
          description: 'The platform that rights are calculated for'
        startTime:
          type: string
          description: 'Start time of the record this object relates to'
        holdbackInput:
          $ref: '#/components/schemas/HoldbackCalculationInput'
        restrictionsInput:
          $ref: '#/components/schemas/RestrictionsCalculationInput'
      required:
        - recordId
        - platform
        - startTime
        - holdbackInput
        - restrictionsInput

    HoldbackCalculationInput:
      description: 'A holdback specific Data Transfer Object which should be used to carry all values needed for calculating holdback for a record between services'
      type: object
      properties:
        hensigt:
          type: integer
          description: 'A metadata value used for holdback calculation'
        form:
          type: integer
          description: 'A metadata value used for holdback calculation'
        indhold:
          type: integer
          description: 'A metadata value used for holdback calculation'
        productionCountry:
          type: integer
          description: 'A metadata value used for holdback calculation'
        origin:
          type: string
          description: 'Origin in the DS ecosystem. Used to determine how holdback should be calculated'
      required:
        - hensigt
        - form
        - indhold
        - productionCountry
        - origin

    RestrictionsCalculationInput:
      description: 'A restrictions specific Data Transfer Object which should be used to carry all values needed for looking up if a record is restricted between services'
      type: object
      properties:
        recordId:
          type: string
          description: 'Id of the record, which this metadata comes from'
        productionCode:
          type: string
          description: 'A metadata value used for holdback and own production calculation'
        drProductionId:
          type: string
          description: 'An internal id from DR which could be restricted'
        title:
          type: string
          description: 'Title of the record in hand. There is a chance that it is restricted'
      required:
        - recordId
        - productionCode
        - drProductionId
        - title

    RightsCalculationOutput:
      description: 'A Data Transfer Object containing the solr fields and values that have been created from the calculations based on a RightsCalculationInput object'
      type: object
      properties: # Platform nesting of calculation results. When more platforms need rights calculations output objects should be appended here.
        generel:
          $ref: '#/components/schemas/RightsCalculationOutputGeneral'
        dr:
          $ref: '#/components/schemas/RightsCalculationOutputDr'

    RightsCalculationOutputGeneral:
      type: object
      description: 'Object containing results from all rights calculations that are applicable in general for the record'
      properties:
        dsIdRestricted:
          type: boolean
          description: 'A boolean representing if our dsId for the record has been restricted'

    RightsCalculationOutputDr:
      type: object
      description: 'Object containing results from all rights calculations that are applicable for the DR Archive for the record'
      properties:
        dsIdRestricted:
          type: boolean
          description: 'A boolean representing if our dsId for the record has been restricted'
        holdbackName:
          type: string
          description: 'The name of the holdback category for the record'
        holdbackExpiredDate:
          type: string
          description: 'The date, when the record is out of holdback. This gets calculated by adding X amount of days to the start time of the recording, where X is defined 
          based on holdbackName'
        productionCodeAllowed:
          type: boolean
          description: 'A value used to specify if the record in hand is "ownproduction" and can be shown in the archive'
        drIdRestricted:
          type: boolean
          description: 'A boolean representing if DRs internal production id for the record has been restricted'
        titleRestricted:
          type: boolean
          description: 'Some titles are not allowed to be watched, if this boolean is true, then the record cannot be shown'

    Whoami:
      type: object
      description: 'OAuth2 information derived from the request'
      properties:
        token:
          type: object
          required:
            - present
          properties:
            present:
              type: boolean
              description: 'True if an OAuth2 accessToken was present in the request, else false'
              example: true
            valid:
              type: boolean
              description: 'True is an OAuth2 accessToken was present and valid, else false'
              example: false
            error:
              type: string
              description: 'If the accessToken is not valid, the reason will be stated here'
            roles:
              type: array
              items:
                type: string
              description: 'The roles stated in the OAuth2 accessToken'
              example: [ read, write, admin ]

    Error:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: integer
          format: int32
        message:
          type: string

    # Basic status response component.
    # TODO: Extend this to provide application specific status, such as a list of running jobs or free disk space
    Status:
      type: object
      required:
        - application
        - version
      properties:
        application:
          type: string
          description: 'The name of the application'
          example: 'MyService'
        version:
          type: string
          description: 'The version of the application'
          example: '1.2.3'
        build:
          type: string
          description: 'When the application was build'
          example: '2022-04-21T13:37:16Z'
        java:
          type: string
          description: 'The Java version that runs the container'
          example: '11.0.11'
        heap:
          type: integer
          format: int64
          description: 'The maximum number of bytes available to the container in megabytes'
          example: '4096'
        server:
          type: string
          description: 'The hostname for the server'
          example: 'miaplacidus'
        health:
          type: string
          description: 'Self diagnosed health'
          example: 'ok'
        gitCommitChecksum:
          type: string
          description: 'The checksum of the deployed commit'
          example: 'ca82a6dff817ec66f44342007202690a93763949'
        gitBranch:
          type: string
          description: 'The current deployed branch'
          example: master
        gitClosestTag:
          type: string
          description: 'The closest tag of the deployed branch'
        gitCommitTime:
          type: string
          description: 'The time for the latest commit of the deployed branch'

    RecordsCount:
      type: object
      properties:
        count:
          type: integer
          format: int32
          description: 'Number of records updated'

  securitySchemes:
    KBOAuth:
      type: oauth2
      description: 'This API uses OAuth 2 with the implicit grant flow. [More info](https://api.example.com/docs/auth)'
      flows:
        implicit: # <---- OAuth flow(authorizationCode, implicit, password or clientCredentials)
          #authorizationUrl is not used. Instead it uses keycloak url from yaml property file aegis-devel.
          #If we figure out what this is supposed to be used for, inject the value from yaml file  ${config.yaml.path}           
          authorizationUrl: https://api.example.com/oauth2/authorize
          scopes:
            generic_ds: 'Scope used for all Digitale Samlinger services'
            # Project specific roles
            read: 'read data'
            write: 'modify or delete data'
            # General roles at the Royal Danish Library
            devel: 'broad read access'
            admin: 'all rights'
            # Meta role controlling authorization behaviour
            public: 'allowed for all, authorization optional, implementation behaviour depending on caller roles'
            any: 'allowed for all, authorization mandatory, implementation behaviour depending on caller roles'